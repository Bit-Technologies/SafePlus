(function(e,t){if(typeof define=="function"&&define.amd){define(e)}else if(typeof module!="undefined"&&typeof exports=="object"){module.exports=e()}else{t.rangy=e()}})(function(){var e="object",t="function",n="undefined";var r=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var i=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var a=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var o=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function s(n,r){var i=typeof n[r];return i==t||!!(i==e&&n[r])||i=="unknown"}function f(t,n){return!!(typeof t[n]==e&&t[n])}function l(e,t){return typeof e[t]!=n}function c(e){return function(t,n){var r=n.length;while(r--){if(!e(t,n[r])){return false}}return true}}var u=c(s);var d=c(f);var h=c(l);function g(e){return e&&u(e,o)&&h(e,a)}function p(e){return f(e,"body")?e.body:e.getElementsByTagName("body")[0]}var v={};var m=typeof window!=n&&typeof document!=n;var R={isHostMethod:s,isHostObject:f,isHostProperty:l,areHostMethods:u,areHostObjects:d,areHostProperties:h,isTextRange:g,getBody:p};var C={version:"1.3.0-alpha.20140921",initialized:false,isBrowser:m,supported:true,util:R,features:{},modules:v,config:{alertOnFail:true,alertOnWarn:false,preferTextRange:false,autoInitialize:typeof rangyAutoInitialize==n?true:rangyAutoInitialize}};function N(e){if(typeof console!=n&&s(console,"log")){console.log(e)}}function y(e,t){if(m&&t){alert(e)}else{N(e)}}function E(e){C.initialized=true;C.supported=false;y("Rangy is not supported in this environment. Reason: "+e,C.config.alertOnFail)}C.fail=E;function S(e){y("Rangy warning: "+e,C.config.alertOnWarn)}C.warn=S;var w;if({}.hasOwnProperty){R.extend=w=function(e,t,n){var r,i;for(var a in t){if(t.hasOwnProperty(a)){r=e[a];i=t[a];if(n&&r!==null&&typeof r=="object"&&i!==null&&typeof i=="object"){w(r,i,true)}e[a]=i}}if(t.hasOwnProperty("toString")){e.toString=t.toString}return e};R.createOptions=function(e,t){var n={};w(n,t);if(e){w(n,e)}return n}}else{E("hasOwnProperty not supported")}if(!m){E("Rangy can only run in a browser")}(function(){var e;if(m){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{if(n.call(t.childNodes,0)[0].nodeType==1){e=function(e){return n.call(e,0)}}}catch(r){}}if(!e){e=function(e){var t=[];for(var n=0,r=e.length;n<r;++n){t[n]=e[n]}return t}}R.toArray=e})();var T;if(m){if(s(document,"addEventListener")){T=function(e,t,n){e.addEventListener(t,n,false)}}else if(s(document,"attachEvent")){T=function(e,t,n){e.attachEvent("on"+t,n)}}else{E("Document does not have required addEventListener or attachEvent method")}R.addListener=T}var O=[];function A(e){return e.message||e.description||String(e)}function x(){if(!m||C.initialized){return}var e;var t=false,n=false;if(s(document,"createRange")){e=document.createRange();if(u(e,i)&&h(e,r)){t=true}}var a=p(document);if(!a||a.nodeName.toLowerCase()!="body"){E("No body element found");return}if(a&&s(a,"createTextRange")){e=a.createTextRange();if(g(e)){n=true}}if(!t&&!n){E("Neither Range nor TextRange are available");return}C.initialized=true;C.features={implementsDomRange:t,implementsTextRange:n};var o,f;for(var l in v){if((o=v[l])instanceof D){o.init(o,C)}}for(var c=0,d=O.length;c<d;++c){try{O[c](C)}catch(R){f="Rangy init listener threw an exception. Continuing. Detail: "+A(R);N(f)}}}C.init=x;C.addInitListener=function(e){if(C.initialized){e(C)}else{O.push(e)}};var _=[];C.addShimListener=function(e){_.push(e)};function b(e){e=e||window;x();for(var t=0,n=_.length;t<n;++t){_[t](e)}}if(m){C.shim=C.createMissingNativeApi=b}function D(e,t,n){this.name=e;this.dependencies=t;this.initialized=false;this.supported=false;this.initializer=n}D.prototype={init:function(){var e=this.dependencies||[];for(var t=0,n=e.length,r,i;t<n;++t){i=e[t];r=v[i];if(!r||!(r instanceof D)){throw new Error("required module '"+i+"' not found")}r.init();if(!r.supported){throw new Error("required module '"+i+"' not supported")}}this.initializer(this)},fail:function(e){this.initialized=true;this.supported=false;throw new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){C.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){C.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}};function I(e,t,n){var r=new D(e,t,function(t){if(!t.initialized){t.initialized=true;try{n(C,t);t.supported=true}catch(r){var i="Module '"+e+"' failed to load: "+A(r);N(i);if(r.stack){N(r.stack)}}}});v[e]=r;return r}C.createModule=function(e){var t,n;if(arguments.length==2){t=arguments[1];n=[]}else{t=arguments[2];n=arguments[1]}var r=I(e,n,t);if(C.initialized&&C.supported){r.init()}};C.createCoreModule=function(e,t,n){I(e,t,n)};function P(){}C.RangePrototype=P;C.rangePrototype=new P;function B(){}C.selectionPrototype=new B;C.createCoreModule("DomUtil",[],function(e,t){var n="undefined";var r=e.util;if(!r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){t.fail("document missing a Node creation method")}if(!r.isHostMethod(document,"getElementsByTagName")){t.fail("document missing getElementsByTagName method")}var i=document.createElement("div");if(!r.areHostMethods(i,["insertBefore","appendChild","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"]))){t.fail("Incomplete Element implementation")}if(!r.isHostProperty(i,"innerHTML")){t.fail("Element is missing innerHTML property")}var a=document.createTextNode("test");if(!r.areHostMethods(a,["splitText","deleteData","insertData","appendData","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"])||!r.areHostProperties(a,["data"]))){t.fail("Incomplete Text Node implementation")}var o=function(e,t){var n=e.length;while(n--){if(e[n]===t){return true}}return false};function s(e){var t;return typeof e.namespaceURI==n||(t=e.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml"}function f(e){var t=e.parentNode;return t.nodeType==1?t:null}function l(e){var t=0;while(e=e.previousSibling){++t}return t}function c(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function u(e,t){var n=[],r;for(r=e;r;r=r.parentNode){n.push(r)}for(r=t;r;r=r.parentNode){if(o(n,r)){return r}}return null}function d(e,t,n){var r=n?t:t.parentNode;while(r){if(r===e){return true}else{r=r.parentNode}}return false}function h(e,t){return d(e,t,true)}function g(e,t,n){var r,i=n?e:e.parentNode;while(i){r=i.parentNode;if(r===t){return i}i=r}return null}function p(e){var t=e.nodeType;return t==3||t==4||t==8}function v(e){if(!e){return false}var t=e.nodeType;return t==3||t==8}function m(e,t){var n=t.nextSibling,r=t.parentNode;if(n){r.insertBefore(e,n)}else{r.appendChild(e)}return e}function R(e,t,n){var r=e.cloneNode(false);r.deleteData(0,t);e.deleteData(t,e.length-t);m(r,e);if(n){for(var i=0,a;a=n[i++];){if(a.node==e&&a.offset>t){a.node=r;a.offset-=t}else if(a.node==e.parentNode&&a.offset>l(e)){++a.offset}}}return r}function C(e){if(e.nodeType==9){return e}else if(typeof e.ownerDocument!=n){return e.ownerDocument}else if(typeof e.document!=n){return e.document}else if(e.parentNode){return C(e.parentNode)}else{throw t.createError("getDocument: no document found for node")}}function N(e){var r=C(e);if(typeof r.defaultView!=n){return r.defaultView}else if(typeof r.parentWindow!=n){return r.parentWindow}else{throw t.createError("Cannot get a window object for node")}}function y(e){if(typeof e.contentDocument!=n){return e.contentDocument}else if(typeof e.contentWindow!=n){return e.contentWindow.document}else{throw t.createError("getIframeDocument: No Document object found for iframe element")}}function E(e){if(typeof e.contentWindow!=n){return e.contentWindow}else if(typeof e.contentDocument!=n){return e.contentDocument.defaultView}else{throw t.createError("getIframeWindow: No Window object found for iframe element")}}function S(e){return e&&r.isHostMethod(e,"setTimeout")&&r.isHostObject(e,"document")}function w(e,t,n){var i;if(!e){i=document}else if(r.isHostProperty(e,"nodeType")){i=e.nodeType==1&&e.tagName.toLowerCase()=="iframe"?y(e):C(e)}else if(S(e)){i=e.document}if(!i){throw t.createError(n+"(): Parameter must be a Window object or DOM node")}return i}function T(e){var t;while(t=e.parentNode){e=t}return e}function O(e,n,r,i){var a,o,s,f,c;if(e==r){return n===i?0:n<i?-1:1}else if(a=g(r,e,true)){return n<=l(a)?-1:1}else if(a=g(e,r,true)){return l(a)<i?-1:1}else{o=u(e,r);if(!o){throw new Error("comparePoints error: nodes have no common ancestor")}s=e===o?o:g(e,o,true);f=r===o?o:g(r,o,true);if(s===f){throw t.createError("comparePoints got to case 4 and childA and childB are the same!")}else{c=o.firstChild;while(c){if(c===s){return-1}else if(c===f){return 1}c=c.nextSibling}}}}var A=false;function x(e){var t;try{t=e.parentNode;return false}catch(n){return true}}(function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br>";A=x(n);e.features.crashyTextNodes=A})();function _(e){if(!e){return"[No node]"}if(A&&x(e)){return"[Broken node]"}if(p(e)){return'"'+e.data+'"'}if(e.nodeType==1){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+l(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function b(e){var t=C(e).createDocumentFragment(),n;while(n=e.firstChild){t.appendChild(n)}return t}var D;if(typeof window.getComputedStyle!=n){D=function(e,t){return N(e).getComputedStyle(e,null)[t]}}else if(typeof document.documentElement.currentStyle!=n){D=function(e,t){return e.currentStyle[t]}}else{t.fail("No means of obtaining computed style properties found")}function I(e){this.root=e;this._next=e}I.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;var t,n;if(this._current){t=e.firstChild;if(t){this._next=t}else{n=null;while(e!==this.root&&!(n=e.nextSibling)){e=e.parentNode}this._next=n}}return this._current},detach:function(){this._current=this._next=this.root=null}};function P(e){return new I(e)}function B(e,t){this.node=e;this.offset=t}B.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+_(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};function M(e){this.code=this[e];this.codeName=e;this.message="DOMException: "+this.codeName}M.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24};M.prototype.toString=function(){return this.message};e.dom={arrayContains:o,isHtmlNamespace:s,parentElement:f,getNodeIndex:l,getNodeLength:c,getCommonAncestor:u,isAncestorOf:d,isOrIsAncestorOf:h,getClosestAncestorIn:g,isCharacterDataNode:p,isTextOrCommentNode:v,insertAfter:m,splitDataNode:R,getDocument:C,getWindow:N,getIframeWindow:E,getIframeDocument:y,getBody:r.getBody,isWindow:S,getContentDocument:w,getRootContainer:T,comparePoints:O,isBrokenNode:x,inspectNode:_,getComputedStyleProperty:D,fragmentFromNodeChildren:b,createIterator:P,DomPosition:B};e.DOMException=M});C.createCoreModule("DomRange",["DomUtil"],function(e,t){var n=e.dom;var r=e.util;var i=n.DomPosition;var a=e.DOMException;var o=n.isCharacterDataNode;var s=n.getNodeIndex;var f=n.isOrIsAncestorOf;var l=n.getDocument;var c=n.comparePoints;var u=n.splitDataNode;var d=n.getClosestAncestorIn;var h=n.getNodeLength;var g=n.arrayContains;var p=n.getRootContainer;var v=e.features.crashyTextNodes;function m(e,t){return e.nodeType!=3&&(f(e,t.startContainer)||f(e,t.endContainer))}function R(e){return e.document||l(e.startContainer)}function C(e){return new i(e.parentNode,s(e))}function N(e){return new i(e.parentNode,s(e)+1)}function y(e,t,r){var i=e.nodeType==11?e.firstChild:e;if(o(t)){if(r==t.length){n.insertAfter(e,t)}else{t.parentNode.insertBefore(e,r==0?t:u(t,r))}}else if(r>=t.childNodes.length){t.appendChild(e)}else{t.insertBefore(e,t.childNodes[r])}return i}function E(e,t,n){$(e);$(t);if(R(t)!=R(e)){throw new a("WRONG_DOCUMENT_ERR")}var r=c(e.startContainer,e.startOffset,t.endContainer,t.endOffset),i=c(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?r<=0&&i>=0:r<0&&i>0}function S(e){var t;for(var n,r=R(e.range).createDocumentFragment(),i;n=e.next();){t=e.isPartiallySelectedSubtree();n=n.cloneNode(!t);if(t){i=e.getSubtreeIterator();n.appendChild(S(i));i.detach()}if(n.nodeType==10){throw new a("HIERARCHY_REQUEST_ERR")}r.appendChild(n)}return r}function w(e,t,r){var i,a;r=r||{stop:false};for(var o,s;o=e.next();){if(e.isPartiallySelectedSubtree()){if(t(o)===false){r.stop=true;return}else{s=e.getSubtreeIterator();w(s,t,r);s.detach();if(r.stop){return}}}else{i=n.createIterator(o);while(a=i.next()){if(t(a)===false){r.stop=true;return}}}}}function T(e){var t;while(e.next()){if(e.isPartiallySelectedSubtree()){t=e.getSubtreeIterator();T(t);t.detach()}else{e.remove()}}}function O(e){for(var t,n=R(e.range).createDocumentFragment(),r;t=e.next();){if(e.isPartiallySelectedSubtree()){t=t.cloneNode(false);r=e.getSubtreeIterator();t.appendChild(O(r));r.detach()}else{e.remove()}if(t.nodeType==10){throw new a("HIERARCHY_REQUEST_ERR")}n.appendChild(t)}return n}function A(e,t,n){var r=!!(t&&t.length),i;var a=!!n;if(r){i=new RegExp("^("+t.join("|")+")$")}var s=[];w(new _(e,false),function(t){if(r&&!i.test(t.nodeType)){return}if(a&&!n(t)){return}var f=e.startContainer;if(t==f&&o(f)&&e.startOffset==f.length){return}var l=e.endContainer;if(t==l&&o(l)&&e.endOffset==0){return}s.push(t)});return s}function x(e){var t=typeof e.getName=="undefined"?"Range":e.getName();return"["+t+"("+n.inspectNode(e.startContainer)+":"+e.startOffset+", "+n.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function _(e,t){this.range=e;this.clonePartiallySelectedTextNodes=t;if(!e.collapsed){this.sc=e.startContainer;this.so=e.startOffset;this.ec=e.endContainer;this.eo=e.endOffset;var n=e.commonAncestorContainer;if(this.sc===this.ec&&o(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=this.sc===n&&!o(this.sc)?this.sc.childNodes[this.so]:d(this.sc,n,true);this._last=this.ec===n&&!o(this.ec)?this.ec.childNodes[this.eo-1]:d(this.ec,n,true)}}}_.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;if(e){this._next=e!==this._last?e.nextSibling:null;if(o(e)&&this.clonePartiallySelectedTextNodes){if(e===this.ec){(e=e.cloneNode(true)).deleteData(this.eo,e.length-this.eo)}if(this._current===this.sc){(e=e.cloneNode(true)).deleteData(0,this.so)}}}return e},remove:function(){var e=this._current,t,n;if(o(e)&&(e===this.sc||e===this.ec)){t=e===this.sc?this.so:0;n=e===this.ec?this.eo:e.length;if(t!=n){e.deleteData(t,n-t)}}else{if(e.parentNode){e.parentNode.removeChild(e)}else{}}},isPartiallySelectedSubtree:function(){var e=this._current;return m(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode){e=this.range.cloneRange();e.collapse(false)}else{e=new vt(R(this.range));var t=this._current;var n=t,r=0,i=t,a=h(t);if(f(t,this.sc)){n=this.sc;r=this.so}if(f(t,this.ec)){i=this.ec;a=this.eo}pt(e,n,r,i,a)}return new _(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var b=[1,3,4,5,7,8,10];var D=[2,9,11];var I=[5,6,10,12];var P=[1,3,4,5,7,8,10,11];var B=[1,3,4,5,7,8];function M(e){return function(t,n){var r,i=n?t:t.parentNode;while(i){r=i.nodeType;if(g(e,r)){return i}i=i.parentNode}return null}}var H=M([9,11]);var k=M(I);var W=M([6,10,12]);function L(e,t){if(W(e,t)){throw new a("INVALID_NODE_TYPE_ERR")}}function F(e,t){if(!g(t,e.nodeType)){throw new a("INVALID_NODE_TYPE_ERR")}}function j(e,t){if(t<0||t>(o(e)?e.length:e.childNodes.length)){throw new a("INDEX_SIZE_ERR")}}function z(e,t){if(H(e,true)!==H(t,true)){throw new a("WRONG_DOCUMENT_ERR")}}function U(e){if(k(e,true)){throw new a("NO_MODIFICATION_ALLOWED_ERR")}}function V(e,t){if(!e){throw new a(t)}}function q(e){return v&&n.isBrokenNode(e)||!g(D,e.nodeType)&&!H(e,true)}function Y(e,t){return t<=(o(e)?e.length:e.childNodes.length)}function Q(e){return!!e.startContainer&&!!e.endContainer&&!q(e.startContainer)&&!q(e.endContainer)&&Y(e.startContainer,e.startOffset)&&Y(e.endContainer,e.endOffset)}function $(e){if(!Q(e)){throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}}var G=document.createElement("style");var X=false;try{G.innerHTML="<b>x</b>";X=G.firstChild.nodeType==3}catch(Z){}e.features.htmlParsingConforms=X;var J=X?function(e){var t=this.startContainer;var r=l(t);if(!t){throw new a("INVALID_STATE_ERR")}var i=null;if(t.nodeType==1){i=t}else if(o(t)){i=n.parentElement(t)}if(i===null||i.nodeName=="HTML"&&n.isHtmlNamespace(l(i).documentElement)&&n.isHtmlNamespace(i)){i=r.createElement("body")}else{i=i.cloneNode(false)}i.innerHTML=e;return n.fragmentFromNodeChildren(i)}:function(e){var t=R(this);var r=t.createElement("body");r.innerHTML=e;return n.fragmentFromNodeChildren(r)};function K(e,t){$(e);var n=e.startContainer,r=e.startOffset,i=e.endContainer,a=e.endOffset;var f=n===i;if(o(i)&&a>0&&a<i.length){u(i,a,t)}if(o(n)&&r>0&&r<n.length){n=u(n,r,t);if(f){a-=r;i=n}else if(i==n.parentNode&&a>=s(n)){a++}r=0}e.setStartAndEnd(n,r,i,a)}function et(e){$(e);var t=e.commonAncestorContainer.parentNode.cloneNode(false);t.appendChild(e.cloneContents());return t.innerHTML}var tt=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var nt=0,rt=1,it=2,at=3;var ot=0,st=1,ft=2,lt=3;r.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){$(this);z(this.startContainer,t.startContainer);var n,r,i,a;var o=e==at||e==nt?"start":"end";var s=e==rt||e==nt?"start":"end";n=this[o+"Container"];r=this[o+"Offset"];i=t[s+"Container"];a=t[s+"Offset"];return c(n,r,i,a)},insertNode:function(e){$(this);F(e,P);U(this.startContainer);if(f(e,this.startContainer)){throw new a("HIERARCHY_REQUEST_ERR")}var t=y(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){$(this);var e,t;if(this.collapsed){return R(this).createDocumentFragment()}else{if(this.startContainer===this.endContainer&&o(this.startContainer)){e=this.startContainer.cloneNode(true);e.data=e.data.slice(this.startOffset,this.endOffset);t=R(this).createDocumentFragment();t.appendChild(e);return t}else{var n=new _(this,true);e=S(n);n.detach()}return e}},canSurroundContents:function(){$(this);U(this.startContainer);U(this.endContainer);var e=new _(this,true);var t=e._first&&m(e._first,this)||e._last&&m(e._last,this);e.detach();return!t},surroundContents:function(e){F(e,B);if(!this.canSurroundContents()){throw new a("INVALID_STATE_ERR")}var t=this.extractContents();if(e.hasChildNodes()){while(e.lastChild){e.removeChild(e.lastChild)}}y(e,this.startContainer,this.startOffset);e.appendChild(t);this.selectNode(e)},cloneRange:function(){$(this);var e=new vt(R(this));var t=tt.length,n;while(t--){n=tt[t];e[n]=this[n]}return e},toString:function(){$(this);var e=this.startContainer;if(e===this.endContainer&&o(e)){return e.nodeType==3||e.nodeType==4?e.data.slice(this.startOffset,this.endOffset):""}else{var t=[],n=new _(this,true);w(n,function(e){if(e.nodeType==3||e.nodeType==4){t.push(e.data)}});n.detach();return t.join("")}},compareNode:function(e){$(this);var t=e.parentNode;var n=s(e);if(!t){throw new a("NOT_FOUND_ERR")}var r=this.comparePoint(t,n),i=this.comparePoint(t,n+1);if(r<0){return i>0?ft:ot}else{return i>0?st:lt}},comparePoint:function(e,t){$(this);V(e,"HIERARCHY_REQUEST_ERR");z(e,this.startContainer);if(c(e,t,this.startContainer,this.startOffset)<0){return-1}else if(c(e,t,this.endContainer,this.endOffset)>0){return 1}return 0},createContextualFragment:J,toHtml:function(){return et(this)},intersectsNode:function(e,t){$(this);V(e,"NOT_FOUND_ERR");if(l(e)!==R(this)){return false}var n=e.parentNode,r=s(e);V(n,"NOT_FOUND_ERR");var i=c(n,r,this.endContainer,this.endOffset),a=c(n,r+1,this.startContainer,this.startOffset);return t?i<=0&&a>=0:i<0&&a>0},isPointInRange:function(e,t){$(this);V(e,"HIERARCHY_REQUEST_ERR");z(e,this.startContainer);return c(e,t,this.startContainer,this.startOffset)>=0&&c(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return E(this,e,false)},intersectsOrTouchesRange:function(e){return E(this,e,true)},intersection:function(e){if(this.intersectsRange(e)){var t=c(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=c(this.endContainer,this.endOffset,e.endContainer,e.endOffset);var r=this.cloneRange();if(t==-1){r.setStart(e.startContainer,e.startOffset)}if(n==1){r.setEnd(e.endContainer,e.endOffset)}return r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();if(c(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1){t.setStart(e.startContainer,e.startOffset)}if(c(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1){t.setEnd(e.endContainer,e.endOffset)}return t}else{throw new a("Ranges do not intersect")}},containsNode:function(e,t){if(t){return this.intersectsNode(e,false)}else{return this.compareNode(e)==lt}},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,h(e))<=0},containsRange:function(e){var t=this.intersection(e);return t!==null&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();t.setEnd(r,r.length);return this.containsRange(t)}else{return this.containsNodeContents(e)}},getNodes:function(e,t){$(this);return A(this,e,t)},getDocument:function(){return R(this)},collapseBefore:function(e){this.setEndBefore(e);this.collapse(false)},collapseAfter:function(e){this.setStartAfter(e);this.collapse(true)},getBookmark:function(t){var r=R(this);var i=e.createRange(r);t=t||n.getBody(r);i.selectNodeContents(t);var a=this.intersection(i);var o=0,s=0;if(a){i.setEnd(a.startContainer,a.startOffset);o=i.toString().length;s=o+a.toString().length}return{start:o,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode;var n=0;this.setStart(t,0);this.collapse(true);var r=[t],i,a=false,o=false;var s,f,l;while(!o&&(i=r.pop())){if(i.nodeType==3){s=n+i.length;if(!a&&e.start>=n&&e.start<=s){this.setStart(i,e.start-n);a=true}if(a&&e.end>=n&&e.end<=s){this.setEnd(i,e.end-n);o=true}n=s}else{l=i.childNodes;f=l.length;while(f--){r.push(l[f])}}}},getName:function(){return"DomRange"},equals:function(e){return vt.rangesEqual(this,e)},isValid:function(){return Q(this)},inspect:function(){return x(this)},detach:function(){}});function ct(e){e.START_TO_START=nt;e.START_TO_END=rt;e.END_TO_END=it;e.END_TO_START=at;e.NODE_BEFORE=ot;e.NODE_AFTER=st;e.NODE_BEFORE_AND_AFTER=ft;e.NODE_INSIDE=lt}function ut(e){ct(e);ct(e.prototype)}function dt(e,t){return function(){$(this);var n=this.startContainer,r=this.startOffset,i=this.commonAncestorContainer;var a=new _(this,true);var o,s;if(n!==i){o=d(n,i,true);s=N(o);n=s.node;r=s.offset}w(a,U);a.reset();var f=e(a);a.detach();t(this,n,r,n,r);return f}}function ht(t,n){function i(e,t){return function(n){F(n,b);F(p(n),D);var r=(e?C:N)(n);(t?a:f)(this,r.node,r.offset)}}function a(e,t,r){var i=e.endContainer,a=e.endOffset;if(t!==e.startContainer||r!==e.startOffset){if(p(t)!=p(i)||c(t,r,i,a)==1){i=t;a=r}n(e,t,r,i,a)}}function f(e,t,r){var i=e.startContainer,a=e.startOffset;if(t!==e.endContainer||r!==e.endOffset){if(p(t)!=p(i)||c(t,r,i,a)==-1){i=t;a=r}n(e,i,a,t,r)}}var l=function(){};l.prototype=e.rangePrototype;t.prototype=new l;r.extend(t.prototype,{setStart:function(e,t){L(e,true);j(e,t);a(this,e,t)},setEnd:function(e,t){L(e,true);j(e,t);f(this,e,t)},setStartAndEnd:function(){var e=arguments;var t=e[0],r=e[1],i=t,a=r;switch(e.length){case 3:a=e[2];break;case 4:i=e[2];a=e[3];break}n(this,t,r,i,a)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:i(true,true),setStartAfter:i(false,true),setEndBefore:i(true,false),setEndAfter:i(false,false),collapse:function(e){$(this);if(e){n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset)}else{n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)}},selectNodeContents:function(e){L(e,true);n(this,e,0,e,h(e))},selectNode:function(e){L(e,false);F(e,b);var t=C(e),r=N(e);n(this,t.node,t.offset,r.node,r.offset)},extractContents:dt(O,n),deleteContents:dt(T,n),canSurroundContents:function(){$(this);U(this.startContainer);U(this.endContainer);var e=new _(this,true);var t=e._first&&m(e._first,this)||e._last&&m(e._last,this);e.detach();return!t},splitBoundaries:function(){K(this)},splitBoundariesPreservingPositions:function(e){K(this,e)},normalizeBoundaries:function(){$(this);var e=this.startContainer,t=this.startOffset,r=this.endContainer,i=this.endOffset;var a=function(e){var t=e.nextSibling;if(t&&t.nodeType==e.nodeType){r=e;i=e.length;e.appendData(t.data);t.parentNode.removeChild(t)}};var f=function(n){var a=n.previousSibling;if(a&&a.nodeType==n.nodeType){e=n;var o=n.length;t=a.length;n.insertData(0,a.data);a.parentNode.removeChild(a);if(e==r){i+=t;r=e}else if(r==n.parentNode){var f=s(n);if(i==f){r=n;i=o}else if(i>f){i--}}}};var l=true;if(o(r)){if(r.length==i){a(r)}}else{if(i>0){var c=r.childNodes[i-1];if(c&&o(c)){a(c)}}l=!this.collapsed}if(l){if(o(e)){if(t==0){f(e)}}else{if(t<e.childNodes.length){var u=e.childNodes[t];if(u&&o(u)){f(u)}}}}else{e=r;t=i}n(this,e,t,r,i)},collapseToPoint:function(e,t){L(e,true);j(e,t);this.setStartAndEnd(e,t)}});ut(t)}function gt(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset;e.commonAncestorContainer=e.collapsed?e.startContainer:n.getCommonAncestor(e.startContainer,e.endContainer)}function pt(e,t,r,i,a){e.startContainer=t;e.startOffset=r;e.endContainer=i;e.endOffset=a;e.document=n.getDocument(t);gt(e)}function vt(e){this.startContainer=e;this.startOffset=0;this.endContainer=e;this.endOffset=0;this.document=e;gt(this)}ht(vt,pt);r.extend(vt,{rangeProperties:tt,RangeIterator:_,copyComparisonConstants:ut,createPrototypeRange:ht,inspect:x,toHtml:et,getRangeDocument:R,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}});e.DomRange=vt});C.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,r;var i=e.dom;var a=e.util;var o=i.DomPosition;var s=e.DomRange;var f=i.getBody;var l=i.getContentDocument;var c=i.isCharacterDataNode;if(e.features.implementsDomRange){(function(){var r;var o=s.rangeProperties;function c(e){var t=o.length,n;while(t--){n=o[t];e[n]=e.nativeRange[n]}e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function u(e,t,n,r,i){var a=e.startContainer!==t||e.startOffset!=n;var o=e.endContainer!==r||e.endOffset!=i;var s=!e.equals(e.nativeRange);if(a||o||s){e.setEnd(r,i);e.setStart(t,n)}}var d;n=function(e){if(!e){throw t.createError("WrappedRange: Range must be specified")}this.nativeRange=e;c(this)};s.createPrototypeRange(n,u);r=n.prototype;r.selectNode=function(e){this.nativeRange.selectNode(e);c(this)};r.cloneContents=function(){return this.nativeRange.cloneContents()};r.surroundContents=function(e){this.nativeRange.surroundContents(e);c(this)};r.collapse=function(e){this.nativeRange.collapse(e);c(this)};r.cloneRange=function(){return new n(this.nativeRange.cloneRange())};r.refresh=function(){c(this)};r.toString=function(){return this.nativeRange.toString()};var h=document.createTextNode("test");f(document).appendChild(h);var g=document.createRange();g.setStart(h,0);g.setEnd(h,0);try{g.setStart(h,1);r.setStart=function(e,t){this.nativeRange.setStart(e,t);c(this)};r.setEnd=function(e,t){this.nativeRange.setEnd(e,t);c(this)};d=function(e){return function(t){this.nativeRange[e](t);c(this)}}}catch(p){r.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t);this.nativeRange.setStart(e,t)}c(this)};r.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t);this.nativeRange.setEnd(e,t)}c(this)};d=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n);this.nativeRange[e](n)}c(this)}}}r.setStartBefore=d("setStartBefore","setEndBefore");r.setStartAfter=d("setStartAfter","setEndAfter");r.setEndBefore=d("setEndBefore","setStartBefore");r.setEndAfter=d("setEndAfter","setStartAfter");r.selectNodeContents=function(e){this.setStartAndEnd(e,0,i.getNodeLength(e))};g.selectNodeContents(h);g.setEnd(h,3);var v=document.createRange();v.selectNodeContents(h);v.setEnd(h,4);v.setStart(h,2);if(g.compareBoundaryPoints(g.START_TO_END,v)==-1&&g.compareBoundaryPoints(g.END_TO_START,v)==1){r.compareBoundaryPoints=function(e,t){t=t.nativeRange||t;if(e==t.START_TO_END){e=t.END_TO_START}else if(e==t.END_TO_START){e=t.START_TO_END}return this.nativeRange.compareBoundaryPoints(e,t)}}else{r.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)}}var m=document.createElement("div");m.innerHTML="123";var R=m.firstChild;var C=f(document);C.appendChild(m);g.setStart(R,1);g.setEnd(R,2);g.deleteContents();if(R.data=="13"){r.deleteContents=function(){this.nativeRange.deleteContents();c(this)};r.extractContents=function(){var e=this.nativeRange.extractContents();c(this);return e}}else{}C.removeChild(m);C=null;if(a.isHostMethod(g,"createContextualFragment")){r.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}}f(document).removeChild(h);r.getName=function(){return"WrappedRange"};e.WrappedRange=n;e.createNativeRange=function(e){e=l(e,t,"createNativeRange");return e.createRange()}})()}if(e.features.implementsTextRange){var u=function(e){var t=e.parentElement();var n=e.duplicate();n.collapse(true);var r=n.parentElement();n=e.duplicate();n.collapse(false);var a=n.parentElement();var o=r==a?r:i.getCommonAncestor(r,a);return o==t?o:i.getCommonAncestor(t,o)};var d=function(e){return e.compareEndPoints("StartToEnd",e)==0};var h=function(e,t,n,r,a){var s=e.duplicate();s.collapse(n);var f=s.parentElement();if(!i.isOrIsAncestorOf(t,f)){f=t}if(!f.canHaveHTML){var l=new o(f.parentNode,i.getNodeIndex(f));return{boundaryPosition:l,nodeInfo:{nodeIndex:l.offset,containerElement:l.node}}}var u=i.getDocument(f).createElement("span");if(u.parentNode){u.parentNode.removeChild(u)}var d,h=n?"StartToStart":"StartToEnd";var g,p,v,m;var R=a&&a.containerElement==f?a.nodeIndex:0;var C=f.childNodes.length;var N=C;var y=N;while(true){if(y==C){f.appendChild(u)}else{f.insertBefore(u,f.childNodes[y])}s.moveToElementText(u);d=s.compareEndPoints(h,e);if(d==0||R==N){break}else if(d==-1){if(N==R+1){break}else{R=y}}else{N=N==R+1?R:y}y=Math.floor((R+N)/2);f.removeChild(u)}m=u.nextSibling;if(d==-1&&m&&c(m)){s.setEndPoint(n?"EndToStart":"EndToEnd",e);var E;if(/[\r\n]/.test(m.data)){var S=s.duplicate();var w=S.text.replace(/\r\n/g,"\r").length;E=S.moveStart("character",w);while((d=S.compareEndPoints("StartToEnd",S))==-1){E++;S.moveStart("character",1)}}else{E=s.text.length}v=new o(m,E)}else{g=(r||!n)&&u.previousSibling;p=(r||n)&&u.nextSibling;if(p&&c(p)){v=new o(p,0)}else if(g&&c(g)){v=new o(g,g.data.length)}else{v=new o(f,i.getNodeIndex(u))
}}u.parentNode.removeChild(u);return{boundaryPosition:v,nodeInfo:{nodeIndex:y,containerElement:f}}};var g=function(e,t){var n,r,a=e.offset;var o=i.getDocument(e.node);var s,l,u=f(o).createTextRange();var d=c(e.node);if(d){n=e.node;r=n.parentNode}else{l=e.node.childNodes;n=a<l.length?l[a]:null;r=e.node}s=o.createElement("span");s.innerHTML="&#feff;";if(n){r.insertBefore(s,n)}else{r.appendChild(s)}u.moveToElementText(s);u.collapse(!t);r.removeChild(s);if(d){u[t?"moveStart":"moveEnd"]("character",a)}return u};r=function(e){this.textRange=e;this.refresh()};r.prototype=new s(document);r.prototype.refresh=function(){var e,t,n;var r=u(this.textRange);if(d(this.textRange)){t=e=h(this.textRange,r,true,true).boundaryPosition}else{n=h(this.textRange,r,true,false);e=n.boundaryPosition;t=h(this.textRange,r,false,false,n.nodeInfo).boundaryPosition}this.setStart(e.node,e.offset);this.setEnd(t.node,t.offset)};r.prototype.getName=function(){return"WrappedTextRange"};s.copyComparisonConstants(r);var p=function(e){if(e.collapsed){return g(new o(e.startContainer,e.startOffset),true)}else{var t=g(new o(e.startContainer,e.startOffset),true);var n=g(new o(e.endContainer,e.endOffset),false);var r=f(s.getRangeDocument(e)).createTextRange();r.setEndPoint("StartToStart",t);r.setEndPoint("EndToEnd",n);return r}};r.rangeToTextRange=p;r.prototype.toTextRange=function(){return p(this)};e.WrappedTextRange=r;if(!e.features.implementsDomRange||e.config.preferTextRange){var v=function(e){return e("return this;")()}(Function);if(typeof v.Range=="undefined"){v.Range=r}e.createNativeRange=function(e){e=l(e,t,"createNativeRange");return f(e).createTextRange()};e.WrappedRange=r}}e.createRange=function(n){n=l(n,t,"createRange");return new e.WrappedRange(e.createNativeRange(n))};e.createRangyRange=function(e){e=l(e,t,"createRangyRange");return new s(e)};e.createIframeRange=function(n){t.deprecationNotice("createIframeRange()","createRange(iframeEl)");return e.createRange(n)};e.createIframeRangyRange=function(n){t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)");return e.createRangyRange(n)};e.addShimListener(function(t){var n=t.document;if(typeof n.createRange=="undefined"){n.createRange=function(){return e.createRange(n)}}n=t=null})});C.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){e.config.checkSelectionRanges=true;var n="boolean";var r="number";var i=e.dom;var a=e.util;var o=a.isHostMethod;var s=e.DomRange;var f=e.WrappedRange;var l=e.DOMException;var c=i.DomPosition;var u;var d;var h=e.features;var g="Control";var p=i.getDocument;var v=i.getBody;var m=s.rangesEqual;function R(e){return typeof e=="string"?/^backward(s)?$/i.test(e):!!e}function C(e,n){if(!e){return window}else if(i.isWindow(e)){return e}else if(e instanceof $){return e.win}else{var r=i.getContentDocument(e,t,n);return i.getWindow(r)}}function N(e){return C(e,"getWinSelection").getSelection()}function y(e){return C(e,"getDocSelection").document.selection}function E(e){var t=false;if(e.anchorNode){t=i.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)==1}return t}var S=o(window,"getSelection"),w=a.isHostObject(document,"selection");h.implementsWinGetSelection=S;h.implementsDocSelection=w;var T=w&&(!S||e.config.preferTextRange);if(T){u=y;e.isSelectionValid=function(e){var t=C(e,"isSelectionValid").document,n=t.selection;return n.type!="None"||p(n.createRange().parentElement())==t}}else if(S){u=N;e.isSelectionValid=function(){return true}}else{t.fail("Neither document.selection or window.getSelection() detected.")}e.getNativeSelection=u;var O=u();var A=e.createNativeRange(document);var x=v(document);var _=a.areHostProperties(O,["anchorNode","focusNode","anchorOffset","focusOffset"]);h.selectionHasAnchorAndFocus=_;var b=o(O,"extend");h.selectionHasExtend=b;var D=typeof O.rangeCount==r;h.selectionHasRangeCount=D;var I=false;var P=true;var B=b?function(t,n){var r=s.getRangeDocument(n);var i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset);t.addRange(F(i));t.extend(n.startContainer,n.startOffset)}:null;if(a.areHostMethods(O,["addRange","getRangeAt","removeAllRanges"])&&typeof O.rangeCount==r&&h.implementsDomRange){(function(){var t=window.getSelection();if(t){var n=t.rangeCount;var r=n>1;var i=[];var a=E(t);for(var o=0;o<n;++o){i[o]=t.getRangeAt(o)}var s=v(document);var f=s.appendChild(document.createElement("div"));f.contentEditable="false";var l=f.appendChild(document.createTextNode("   "));var c=document.createRange();c.setStart(l,1);c.collapse(true);t.addRange(c);P=t.rangeCount==1;t.removeAllRanges();if(!r){var u=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(u&&parseInt(u[1])>=36){I=false}else{var d=c.cloneRange();c.setStart(l,0);d.setEnd(l,3);d.setStart(l,2);t.addRange(c);t.addRange(d);I=t.rangeCount==2}}s.removeChild(f);t.removeAllRanges();for(o=0;o<n;++o){if(o==0&&a){if(B){B(t,i[o])}else{e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend");t.addRange(i[o])}}else{t.addRange(i[o])}}}})()}h.selectionSupportsMultipleRanges=I;h.collapsedNonEditableSelectionsSupported=P;var M=false,H;if(x&&o(x,"createControlRange")){H=x.createControlRange();if(a.areHostProperties(H,["item","add"])){M=true}}h.implementsControlRange=M;if(_){d=function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}}else{d=function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:false}}function k(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"];e.anchorOffset=t[r+"Offset"];e.focusNode=t[i+"Container"];e.focusOffset=t[i+"Offset"]}function W(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode;e.anchorOffset=t.anchorOffset;e.focusNode=t.focusNode;e.focusOffset=t.focusOffset}function L(e){e.anchorNode=e.focusNode=null;e.anchorOffset=e.focusOffset=0;e.rangeCount=0;e.isCollapsed=true;e._ranges.length=0}function F(t){var n;if(t instanceof s){n=e.createNativeRange(t.getDocument());n.setEnd(t.endContainer,t.endOffset);n.setStart(t.startContainer,t.startOffset)}else if(t instanceof f){n=t.nativeRange}else if(h.implementsDomRange&&t instanceof i.getWindow(t.startContainer).Range){n=t}return n}function j(e){if(!e.length||e[0].nodeType!=1){return false}for(var t=1,n=e.length;t<n;++t){if(!i.isAncestorOf(e[0],e[t])){return false}}return true}function z(e){var n=e.getNodes();if(!j(n)){throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element")}return n[0]}function U(e){return!!e&&typeof e.text!="undefined"}function V(e,t){var n=new f(t);e._ranges=[n];k(e,n,false);e.rangeCount=1;e.isCollapsed=n.collapsed}function q(t){t._ranges.length=0;if(t.docSelection.type=="None"){L(t)}else{var n=t.docSelection.createRange();if(U(n)){V(t,n)}else{t.rangeCount=n.length;var r,i=p(n.item(0));for(var a=0;a<t.rangeCount;++a){r=e.createRange(i);r.selectNode(n.item(a));t._ranges.push(r)}t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed;k(t,t._ranges[t.rangeCount-1],false)}}}function Y(e,n){var r=e.docSelection.createRange();var i=z(n);var a=p(r.item(0));var o=v(a).createControlRange();for(var s=0,f=r.length;s<f;++s){o.add(r.item(s))}try{o.add(i)}catch(l){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}o.select();q(e)}var Q;if(o(O,"getRangeAt")){Q=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}}else if(_){Q=function(t){var n=p(t.anchorNode);var r=e.createRange(n);r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset);if(r.collapsed!==this.isCollapsed){r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)}return r}}function $(e,t,n){this.nativeSelection=e;this.docSelection=t;this._ranges=[];this.win=n;this.refresh()}$.prototype=e.selectionPrototype;function G(e){e.win=e.anchorNode=e.focusNode=e._ranges=null;e.rangeCount=e.anchorOffset=e.focusOffset=0;e.detached=true}var X=[];function Z(e,t){var n=X.length,r,i;while(n--){r=X[n];i=r.selection;if(t=="deleteAll"){G(i)}else if(r.win==e){if(t=="delete"){X.splice(n,1);return true}else{return i}}}if(t=="deleteAll"){X.length=0}return null}var J=function(e){if(e&&e instanceof $){e.refresh();return e}e=C(e,"getNativeSelection");var t=Z(e);var n=u(e),r=w?y(e):null;if(t){t.nativeSelection=n;t.docSelection=r;t.refresh()}else{t=new $(n,r,e);X.push({win:e,selection:t})}return t};e.getSelection=J;e.getIframeSelection=function(n){t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)");return e.getSelection(i.getIframeWindow(n))};var K=$.prototype;function et(e,n){var r=p(n[0].startContainer);var i=v(r).createControlRange();for(var a=0,o,s=n.length;a<s;++a){o=z(n[a]);try{i.add(o)}catch(f){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select();q(e)}if(!T&&_&&a.areHostMethods(O,["removeAllRanges","addRange"])){K.removeAllRanges=function(){this.nativeSelection.removeAllRanges();L(this)};var tt=function(e,t){B(e.nativeSelection,t);e.refresh()};if(D){K.addRange=function(t,n){if(M&&w&&this.docSelection.type==g){Y(this,t)}else{if(R(n)&&b){tt(this,t)}else{var r;if(I){r=this.rangeCount}else{this.removeAllRanges();r=0}var i=F(t).cloneRange();try{this.nativeSelection.addRange(i)}catch(a){}this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==r+1){if(e.config.checkSelectionRanges){var o=Q(this.nativeSelection,this.rangeCount-1);if(o&&!m(o,t)){t=new f(o)}}this._ranges[this.rangeCount-1]=t;k(this,t,it(this.nativeSelection));this.isCollapsed=d(this)}else{this.refresh()}}}}}else{K.addRange=function(e,t){if(R(t)&&b){tt(this,e)}else{this.nativeSelection.addRange(F(e));this.refresh()}}}K.setRanges=function(e){if(M&&w&&e.length>1){et(this,e)}else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t){this.addRange(e[t])}}}}else if(o(O,"empty")&&o(A,"select")&&M&&T){K.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var e;if(this.anchorNode){e=p(this.anchorNode)}else if(this.docSelection.type==g){var t=this.docSelection.createRange();if(t.length){e=p(t.item(0))}}if(e){var n=v(e).createTextRange();n.select();this.docSelection.empty()}}}catch(r){}L(this)};K.addRange=function(t){if(this.docSelection.type==g){Y(this,t)}else{e.WrappedTextRange.rangeToTextRange(t).select();this._ranges[0]=t;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;k(this,t,false)}};K.setRanges=function(e){this.removeAllRanges();var t=e.length;if(t>1){et(this,e)}else if(t){this.addRange(e[0])}}}else{t.fail("No means of selecting a Range or TextRange was found");return false}K.getRangeAt=function(e){if(e<0||e>=this.rangeCount){throw new l("INDEX_SIZE_ERR")}else{return this._ranges[e].cloneRange()}};var nt;if(T){nt=function(t){var n;if(e.isSelectionValid(t.win)){n=t.docSelection.createRange()}else{n=v(t.win.document).createTextRange();n.collapse(true)}if(t.docSelection.type==g){q(t)}else if(U(n)){V(t,n)}else{L(t)}}}else if(o(O,"getRangeAt")&&typeof O.rangeCount==r){nt=function(t){if(M&&w&&t.docSelection.type==g){q(t)}else{t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount;if(t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n){t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n))}k(t,t._ranges[t.rangeCount-1],it(t.nativeSelection));t.isCollapsed=d(t)}else{L(t)}}}}else if(_&&typeof O.isCollapsed==n&&typeof A.collapsed==n&&h.implementsDomRange){nt=function(e){var t,n=e.nativeSelection;if(n.anchorNode){t=Q(n,0);e._ranges=[t];e.rangeCount=1;W(e);e.isCollapsed=d(e)}else{L(e)}}}else{t.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}K.refresh=function(e){var t=e?this._ranges.slice(0):null;var n=this.anchorNode,r=this.anchorOffset;nt(this);if(e){var i=t.length;if(i!=this._ranges.length){return true}if(this.anchorNode!=n||this.anchorOffset!=r){return true}while(i--){if(!m(t[i],this._ranges[i])){return true}}return false}};var rt=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,i=n.length;r<i;++r){if(!m(t,n[r])){e.addRange(n[r])}}if(!e.rangeCount){L(e)}};if(M&&w){K.removeRange=function(e){if(this.docSelection.type==g){var t=this.docSelection.createRange();var n=z(e);var r=p(t.item(0));var i=v(r).createControlRange();var a,o=false;for(var s=0,f=t.length;s<f;++s){a=t.item(s);if(a!==n||o){i.add(t.item(s))}else{o=true}}i.select();q(this)}else{rt(this,e)}}}else{K.removeRange=function(e){rt(this,e)}}var it;if(!T&&_&&h.implementsDomRange){it=E;K.isBackward=function(){return it(this)}}else{it=K.isBackward=function(){return false}}K.isBackwards=K.isBackward;K.toString=function(){var e=[];for(var t=0,n=this.rangeCount;t<n;++t){e[t]=""+this._ranges[t]}return e.join("")};function at(e,t){if(e.win.document!=p(t)){throw new l("WRONG_DOCUMENT_ERR")}}K.collapse=function(t,n){at(this,t);var r=e.createRange(t);r.collapseToPoint(t,n);this.setSingleRange(r);this.isCollapsed=true};K.collapseToStart=function(){if(this.rangeCount){var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)}else{throw new l("INVALID_STATE_ERR")}};K.collapseToEnd=function(){if(this.rangeCount){var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)}else{throw new l("INVALID_STATE_ERR")}};K.selectAllChildren=function(t){at(this,t);var n=e.createRange(t);n.selectNodeContents(t);this.setSingleRange(n)};K.deleteFromDocument=function(){if(M&&w&&this.docSelection.type==g){var e=this.docSelection.createRange();var t;while(e.length){t=e.item(0);e.remove(t);t.parentNode.removeChild(t)}this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,i=n.length;r<i;++r){n[r].deleteContents()}this.addRange(n[i-1])}}};K.eachRange=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n){if(e(this.getRangeAt(n))){return t}}};K.getAllRanges=function(){var e=[];this.eachRange(function(t){e.push(t)});return e};K.setSingleRange=function(e,t){this.removeAllRanges();this.addRange(e,t)};K.callMethodOnEachRange=function(e,t){var n=[];this.eachRange(function(r){n.push(r[e].apply(r,t))});return n};function ot(t){return function(n,r){var i;if(this.rangeCount){i=this.getRangeAt(0);i["set"+(t?"Start":"End")](n,r)}else{i=e.createRange(this.win.document);i.setStartAndEnd(n,r)}this.setSingleRange(i,this.isBackward())}}K.setStart=ot(true);K.setEnd=ot(false);e.rangePrototype.select=function(e){J(this.getDocument()).setSingleRange(this,e)};K.changeEachRange=function(e){var t=[];var n=this.isBackward();this.eachRange(function(n){e(n);t.push(n)});this.removeAllRanges();if(n&&t.length==1){this.addRange(t[0],"backward")}else{this.setRanges(t)}};K.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},true)||false};K.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}};K.moveToBookmark=function(t){var n=[];for(var r=0,i,a;i=t.rangeBookmarks[r++];){a=e.createRange(this.win);a.moveToBookmark(i);n.push(a)}if(t.backward){this.setSingleRange(n[0],"backward")}else{this.setRanges(n)}};K.toHtml=function(){var e=[];this.eachRange(function(t){e.push(s.toHtml(t))});return e.join("")};if(h.implementsTextRange){K.getNativeTextRange=function(){var n,r;if(n=this.docSelection){var i=n.createRange();if(U(i)){return i}else{throw t.createError("getNativeTextRange: selection is a control selection")}}else if(this.rangeCount>0){return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0))}else{throw t.createError("getNativeTextRange: selection contains no range")}}}function st(e){var t=[];var n=new c(e.anchorNode,e.anchorOffset);var r=new c(e.focusNode,e.focusOffset);var i=typeof e.getName=="function"?e.getName():"Selection";if(typeof e.rangeCount!="undefined"){for(var a=0,o=e.rangeCount;a<o;++a){t[a]=s.inspect(e.getRangeAt(a))}}return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}K.getName=function(){return"WrappedSelection"};K.inspect=function(){return st(this)};K.detach=function(){Z(this.win,"delete");G(this)};$.detachAll=function(){Z(null,"deleteAll")};$.inspect=st;$.isDirectionBackward=R;e.Selection=$;e.selectionPrototype=K;e.addShimListener(function(e){if(typeof e.getSelection=="undefined"){e.getSelection=function(){return J(e)}}e=null})});var M=false;var H=function(e){if(!M){M=true;if(!C.initialized&&C.config.autoInitialize){x()}}};if(m){if(document.readyState=="complete"){H()}else{if(s(document,"addEventListener")){document.addEventListener("DOMContentLoaded",H,false)}T(window,"load",H)}}return C},this);(function(e,t){if(typeof define=="function"&&define.amd){define(["./rangy-core"],e)}else if(typeof module!="undefined"&&typeof exports=="object"){module.exports=e(require("rangy"))}else{e(t.rangy)}})(function(e){e.createModule("ClassApplier",["WrappedSelection"],function(e,t){var n=e.dom;var r=n.DomPosition;var i=n.arrayContains;var a=n.isHtmlNamespace;var o="span";function s(e,t){for(var n in e){if(e.hasOwnProperty(n)){if(t(n,e[n])===false){return false}}}return true}function f(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function l(e,t){if(typeof t==="undefined"||t===null)return false;return e.className&&new RegExp("(?:^|\\s)"+t+"(?:\\s|$)").test(e.className)}function c(e,t){if(typeof t==="undefined"||t===null)return;if(e.className){if(!l(e,t)){e.className+=" "+t}}else{e.className=t}}var u=function(){function e(e,t,n){return t&&n?" ":""}return function(t,n){if(typeof n==="undefined"||n===null)return;if(t.className){t.className=t.className.replace(new RegExp("(^|\\s)"+n+"(\\s|$)"),e)}}}();function d(e){if(typeof e==="undefined"||e===null)return;return e&&e.split(/\s+/).sort().join(" ")}function h(e){return d(e.className)}function g(e,t){return h(e)==h(t)}function p(e,t,n,r,i){var a=e.node,o=e.offset;var s=a,f=o;if(a==r&&o>i){++f}if(a==t&&(o==n||o==n+1)){s=r;f+=i-n}if(a==t&&o>n+1){--f}e.node=s;e.offset=f}function v(e,t,n){if(e.node==t&&e.offset>n){--e.offset}}function m(e,t,r,i){if(r==-1){r=t.childNodes.length}var a=e.parentNode;var o=n.getNodeIndex(e);for(var s=0,f;f=i[s++];){p(f,a,o,t,r)}if(t.childNodes.length==r){t.appendChild(e)}else{t.insertBefore(e,t.childNodes[r])}}function R(e,t){var r=e.parentNode;var i=n.getNodeIndex(e);for(var a=0,o;o=t[a++];){v(o,r,i)}e.parentNode.removeChild(e)}function C(e,t,n,r,i){var a,o=[];while(a=e.firstChild){m(a,t,n++,i);o.push(a)}if(r){R(e,i)}return o}function N(e,t){return C(e,e.parentNode,n.getNodeIndex(e),true,t)}function y(e,t){var n=e.cloneRange();n.selectNodeContents(t);var r=n.intersection(e);var i=r?r.toString():"";return i!=""}function E(e){var t=e.getNodes([3]);var n=0,r;while((r=t[n])&&!y(e,r)){++n}var i=t.length-1;while((r=t[i])&&!y(e,r)){--i}return t.slice(n,i+1)}function S(e,t){if(e.attributes.length!=t.attributes.length)return false;for(var n=0,r=e.attributes.length,i,a,o;n<r;++n){i=e.attributes[n];o=i.name;if(o!="class"){a=t.attributes.getNamedItem(o);if(i===null!=(a===null))return false;if(i.specified!=a.specified)return false;if(i.specified&&i.nodeValue!==a.nodeValue)return false}}return true}function w(e,t){for(var n=0,r=e.attributes.length,a;n<r;++n){a=e.attributes[n].name;if(!(t&&i(t,a))&&e.attributes[n].specified&&a!="class"){return true}}return false}function T(e,t){return s(t,function(t,n){if(typeof n=="object"){if(!T(e[t],n)){return false}}else if(e[t]!==n){return false}})}var O=n.getComputedStyleProperty;var A=function(){var e=document.createElement("div");return typeof e.isContentEditable=="boolean"?function(e){return e&&e.nodeType==1&&e.isContentEditable}:function(e){if(!e||e.nodeType!=1||e.contentEditable=="false"){return false}return e.contentEditable=="true"||A(e.parentNode)}}();function x(e){var t;return e&&e.nodeType==1&&((t=e.parentNode)&&t.nodeType==9&&t.designMode=="on"||A(e)&&!A(e.parentNode))}function _(e){return(A(e)||e.nodeType!=1&&A(e.parentNode))&&!x(e)}var b=/^inline(-block|-table)?$/i;function D(e){return e&&e.nodeType==1&&!b.test(O(e,"display"))}var I=/[^\r\n\t\f \u200B]/;function P(e){if(e.data.length==0){return true}if(I.test(e.data)){return false}var t=O(e.parentNode,"whiteSpace");switch(t){case"pre":case"pre-wrap":case"-moz-pre-wrap":return false;case"pre-line":if(/[\r\n]/.test(e.data)){return false}}return D(e.previousSibling)||D(e.nextSibling)}function B(e){var t=[],n,i;for(n=0;i=e[n++];){t.push(new r(i.startContainer,i.startOffset),new r(i.endContainer,i.endOffset))}return t}function M(e,t){for(var n=0,r,i,a,o=e.length;n<o;++n){r=e[n];i=t[n*2];a=t[n*2+1];r.setStartAndEnd(i.node,i.offset,a.node,a.offset)}}function H(e,t){if(n.isCharacterDataNode(e)){if(t==0){return!!e.previousSibling}else if(t==e.length){return!!e.nextSibling}else{return true}}return t>0&&t<e.childNodes.length}function k(e,r,i,a){var o,s;var f=i==0;if(n.isAncestorOf(r,e)){return e}if(n.isCharacterDataNode(r)){var l=n.getNodeIndex(r);if(i==0){i=l}else if(i==r.length){i=l+1}else{throw t.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+i+" in "+r.data)}r=r.parentNode}if(H(r,i)){o=r.cloneNode(false);s=r.parentNode;if(o.id){o.removeAttribute("id")}var c,u=0;while(c=r.childNodes[i]){m(c,o,u++,a)}m(o,s,n.getNodeIndex(r)+1,a);return r==e?o:k(e,s,n.getNodeIndex(o),a)}else if(e!=r){o=r.parentNode;var d=n.getNodeIndex(r);if(!f){d++}return k(e,o,d,a)}return e}function W(e,t){return e.namespaceURI==t.namespaceURI&&e.tagName.toLowerCase()==t.tagName.toLowerCase()&&g(e,t)&&S(e,t)&&O(e,"display")=="inline"&&O(t,"display")=="inline"}function L(e){var t=e?"nextSibling":"previousSibling";return function(n,r){var i=n.parentNode;var a=n[t];if(a){if(a&&a.nodeType==3){return a}}else if(r){a=i[t];if(a&&a.nodeType==1&&W(i,a)){var o=a[e?"firstChild":"lastChild"];if(o&&o.nodeType==3){return o}}}return null}}var F=L(false),j=L(true);function z(e){this.isElementMerge=e.nodeType==1;this.textNodes=[];var t=this.isElementMerge?e.lastChild:e;if(t){this.textNodes[0]=t}}z.prototype={doMerge:function(e){var t=this.textNodes;var r=t[0];if(t.length>1){var i=n.getNodeIndex(r);var a=[],o=0,s,f;for(var l=0,c=t.length,u,d;l<c;++l){s=t[l];f=s.parentNode;if(l>0){f.removeChild(s);if(!f.hasChildNodes()){f.parentNode.removeChild(f)}if(e){for(u=0;d=e[u++];){if(d.node==s){d.node=r;d.offset+=o}if(d.node==f&&d.offset>i){--d.offset;if(d.offset==i+1&&l<c-1){d.node=r;d.offset=o}}}}}a[l]=s.data;o+=s.data.length}r.data=a.join("")}return r.data},getLength:function(){var e=this.textNodes.length,t=0;while(e--){t+=this.textNodes[e].length}return t},toString:function(){var e=[];for(var t=0,n=this.textNodes.length;t<n;++t){e[t]="'"+this.textNodes[t].data+"'"}return"[Merge("+e.join(",")+")]"}};var U=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"];var V={};function q(e,t,n){var r,i,a,o,l=this;l.cssClass=l.className=e;var c=null,u={};if(typeof t=="object"&&t!==null){n=t.tagNames;c=t.elementProperties;u=t.elementAttributes;for(i=0;o=U[i++];){if(t.hasOwnProperty(o)){l[o]=t[o]}}r=t.normalize}else{r=t}l.normalize=typeof r=="undefined"?true:r;l.attrExceptions=[];var d=document.createElement(l.elementTagName);l.elementProperties=l.copyPropertiesToElement(c,d,true);s(u,function(e){l.attrExceptions.push(e)});l.elementAttributes=u;l.elementSortedClassName=l.elementProperties.hasOwnProperty("className")?l.elementProperties.className:e;l.applyToAnyTagName=false;var h=typeof n;if(h=="string"){if(n=="*"){l.applyToAnyTagName=true}else{l.tagNames=f(n.toLowerCase()).split(/\s*,\s*/)}}else if(h=="object"&&typeof n.length=="number"){l.tagNames=[];for(i=0,a=n.length;i<a;++i){if(n[i]=="*"){l.applyToAnyTagName=true}else{l.tagNames.push(n[i].toLowerCase())}}}else{l.tagNames=[l.elementTagName]}}q.prototype={elementTagName:o,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:true,applyToEditableOnly:false,useExistingElements:true,removeEmptyElements:true,onElementCreate:null,copyPropertiesToElement:function(e,t,n){var r,i,a={},o,s,f,l;for(var u in e){if(e.hasOwnProperty(u)){s=e[u];f=t[u];if(u=="className"){c(t,s);c(t,this.className);t[u]=d(t[u]);if(n){a[u]=t[u]}}else if(u=="style"){i=f;if(n){a[u]=o={}}for(r in e[u]){i[r]=s[r];if(n){o[r]=i[r]}}this.attrExceptions.push(u)}else{t[u]=s;if(n){a[u]=t[u];l=V.hasOwnProperty(u)?V[u]:u;this.attrExceptions.push(l)}}}}return n?a:""},copyAttributesToElement:function(e,t){for(var n in e){if(e.hasOwnProperty(n)){t.setAttribute(n,e[n])}}},hasClass:function(e){return e.nodeType==1&&i(this.tagNames,e.tagName.toLowerCase())&&l(e,this.className)},getSelfOrAncestorWithClass:function(e){while(e){if(this.hasClass(e)){return e}e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||_(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&e.nodeType==3&&P(e)},postApply:function(e,t,n,r){var i=e[0],a=e[e.length-1];var o=[],s;var f=i,l=a;var c=0,u=a.length;var d,h;for(var g=0,p=e.length;g<p;++g){d=e[g];h=F(d,!r);if(h){if(!s){s=new z(h);o.push(s)}s.textNodes.push(d);if(d===i){f=s.textNodes[0];c=f.length}if(d===a){l=s.textNodes[0];u=s.getLength()}}else{s=null}}var v=j(a,!r);if(v){if(!s){s=new z(a);o.push(s)}s.textNodes.push(v)}if(o.length){for(g=0,p=o.length;g<p;++g){o[g].doMerge(n)}t.setStartAndEnd(f,c,l,u)}},createContainer:function(e){var t=e.createElement(this.elementTagName);this.copyPropertiesToElement(this.elementProperties,t,false);this.copyAttributesToElement(this.elementAttributes,t);c(t,this.className);if(this.onElementCreate){this.onElementCreate(t,this)}return t},applyToTextNode:function(e,t){var r=e.parentNode;if(r.childNodes.length==1&&this.useExistingElements&&a(r)&&i(this.tagNames,r.tagName.toLowerCase())&&T(r,this.elementProperties)){c(r,this.className)}else{var o=this.createContainer(n.getDocument(e));e.parentNode.insertBefore(o,e);o.appendChild(e)}},isRemovable:function(e){return a(e)&&e.tagName.toLowerCase()==this.elementTagName&&h(e)==this.elementSortedClassName&&T(e,this.elementProperties)&&!w(e,this.attrExceptions)&&this.isModifiable(e)},isEmptyContainer:function(e){var t=e.childNodes.length;return e.nodeType==1&&this.isRemovable(e)&&(t==0||t==1&&this.isEmptyContainer(e.firstChild))},removeEmptyContainers:function(e){var t=this;var n=e.getNodes([1],function(e){return t.isEmptyContainer(e)});var r=[e];var i=B(r);for(var a=0,o;o=n[a++];){R(o,i)}M(r,i)},undoToTextNode:function(e,t,n,r){if(!t.containsNode(n)){var i=t.cloneRange();i.selectNode(n);if(i.isPointInRange(t.endContainer,t.endOffset)){k(n,t.endContainer,t.endOffset,r);t.setEndAfter(n)}if(i.isPointInRange(t.startContainer,t.startOffset)){n=k(n,t.startContainer,t.startOffset,r)}}if(this.isRemovable(n)){N(n,r)}else{u(n,this.className)}},applyToRange:function(e,t){t=t||[];var n=B(t||[]);e.splitBoundariesPreservingPositions(n);if(this.removeEmptyElements){this.removeEmptyContainers(e)}var r=E(e);if(r.length){for(var i=0,a;a=r[i++];){if(!this.isIgnorableWhiteSpaceNode(a)&&!this.getSelfOrAncestorWithClass(a)&&this.isModifiable(a)){this.applyToTextNode(a,n)}}a=r[r.length-1];e.setStartAndEnd(r[0],0,a,a.length);if(this.normalize){this.postApply(r,e,n,false)}M(t,n)}},applyToRanges:function(e){var t=e.length;while(t--){this.applyToRange(e[t],e)}return e},applyToSelection:function(t){var n=e.getSelection(t);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(e,t){t=t||[];var n=B(t);e.splitBoundariesPreservingPositions(n);if(this.removeEmptyElements){this.removeEmptyContainers(e,n)}var r=E(e);var i,a;var o=r[r.length-1];if(r.length){for(var s=0,f=r.length;s<f;++s){i=r[s];a=this.getSelfOrAncestorWithClass(i);if(a&&this.isModifiable(i)){this.undoToTextNode(i,e,a,n)}e.setStartAndEnd(r[0],0,o,o.length)}if(this.normalize){this.postApply(r,e,n,true)}M(t,n)}},undoToRanges:function(e){var t=e.length;while(t--){this.undoToRange(e[t],e)}return e},undoToSelection:function(t){var n=e.getSelection(t);var r=e.getSelection(t).getAllRanges();this.undoToRanges(r);n.setRanges(r)},isAppliedToRange:function(e){if(e.collapsed||e.toString()==""){return!!this.getSelfOrAncestorWithClass(e.commonAncestorContainer)}else{var t=e.getNodes([3]);if(t.length)for(var n=0,r;r=t[n++];){if(!this.isIgnorableWhiteSpaceNode(r)&&y(e,r)&&this.isModifiable(r)&&!this.getSelfOrAncestorWithClass(r)){return false}}return true}},isAppliedToRanges:function(e){var t=e.length;if(t==0){return false}while(t--){if(!this.isAppliedToRange(e[t])){return false}}return true},isAppliedToSelection:function(t){var n=e.getSelection(t);return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(e){if(this.isAppliedToRange(e)){this.undoToRange(e)}else{this.applyToRange(e)}},toggleSelection:function(e){if(this.isAppliedToSelection(e)){this.undoToSelection(e)}else{this.applyToSelection(e)}},getElementsWithClassIntersectingRange:function(e){var t=[];var n=this;e.getNodes([3],function(e){var r=n.getSelfOrAncestorWithClass(e);if(r&&!i(t,r)){t.push(r)}});return t},detach:function(){}};function Y(e,t,n){return new q(e,t,n)}q.util={hasClass:l,addClass:c,removeClass:u,hasSameClasses:g,replaceWithOwnChildren:N,elementsHaveSameNonClassAttributes:S,elementHasNonClassAttributes:w,splitNodeAt:k,isEditableElement:A,isEditingHost:x,isEditable:_};e.CssClassApplier=e.ClassApplier=q;e.createCssClassApplier=e.createClassApplier=Y})},this);(function(e,t){if(typeof define=="function"&&define.amd){define(["./rangy-core"],e)}else if(typeof module!="undefined"&&typeof exports=="object"){module.exports=e(require("rangy"))}else{e(t.rangy)}})(function(e){e.createModule("SaveRestore",["WrappedRange"],function(e,t){var n=e.dom;var r="﻿";function i(e,t){return(t||document).getElementById(e)}function a(e,t){var i="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2);var a;var o=n.getDocument(e.startContainer);var s=e.cloneRange();s.collapse(t);a=o.createElement("span");a.id=i;a.style.lineHeight="0";a.style.display="none";a.className="rangySelectionBoundary";a.appendChild(o.createTextNode(r));s.insertNode(a);return a}function o(e,n,r,a){var o=i(r,e);if(o){n[a?"setStartBefore":"setEndBefore"](o);o.parentNode.removeChild(o)}else{t.warn("Marker element has been removed. Cannot restore selection.")}}function s(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function f(t,n){var r,i,o=e.DomRange.getRangeDocument(t),s=t.toString();if(t.collapsed){i=a(t,false);return{document:o,markerId:i.id,collapsed:true}}else{i=a(t,false);r=a(t,true);return{document:o,startMarkerId:r.id,endMarkerId:i.id,collapsed:false,backward:n,toString:function(){return"original text: '"+s+"', new text: '"+t.toString()+"'"}}}}function l(n,r){var a=n.document;if(typeof r=="undefined"){r=true}var s=e.createRange(a);if(n.collapsed){var f=i(n.markerId,a);if(f){f.style.display="inline";var l=f.previousSibling;if(l&&l.nodeType==3){f.parentNode.removeChild(f);s.collapseToPoint(l,l.length)}else{s.collapseBefore(f);f.parentNode.removeChild(f)}}else{t.warn("Marker element has been removed. Cannot restore selection.")}}else{o(a,s,n.startMarkerId,true);o(a,s,n.endMarkerId,false)}if(r){s.normalizeBoundaries()}return s}function c(t,n){var r=[],a,o;t=t.slice(0);t.sort(s);for(var l=0,c=t.length;l<c;++l){r[l]=f(t[l],n)}for(l=c-1;l>=0;--l){a=t[l];o=e.DomRange.getRangeDocument(a);if(a.collapsed){a.collapseAfter(i(r[l].markerId,o))}else{a.setEndBefore(i(r[l].endMarkerId,o));a.setStartAfter(i(r[l].startMarkerId,o))}}return r}function u(n){if(!e.isSelectionValid(n)){t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus.");return null}var r=e.getSelection(n);var i=r.getAllRanges();var a=i.length==1&&r.isBackward();var o=c(i,a);if(a){r.setSingleRange(i[0],"backward")}else{r.setRanges(i)}return{win:n,rangeInfos:o,restored:false}}function d(e){var t=[];var n=e.length;for(var r=n-1;r>=0;r--){t[r]=l(e[r],true)}return t}function h(t,n){if(!t.restored){var r=t.rangeInfos;var i=e.getSelection(t.win);var a=d(r),o=r.length;if(o==1&&n&&e.features.selectionHasExtend&&r[0].backward){i.removeAllRanges();
i.addRange(a[0],true)}else{i.setRanges(a)}t.restored=true}}function g(e,t){var n=i(t,e);if(n){n.parentNode.removeChild(n)}}function p(e){var t=e.rangeInfos;for(var n=0,r=t.length,i;n<r;++n){i=t[n];if(i.collapsed){g(e.doc,i.markerId)}else{g(e.doc,i.startMarkerId);g(e.doc,i.endMarkerId)}}}e.util.extend(e,{saveRange:f,restoreRange:l,saveRanges:c,restoreRanges:d,saveSelection:u,restoreSelection:h,removeMarkerElement:g,removeMarkers:p})})},this);