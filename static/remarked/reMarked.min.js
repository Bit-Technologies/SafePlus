reMarked=function(opts){var links=[];var cfg={link_list:false,h1_setext:true,h2_setext:true,h_atx_suf:false,gfm_code:["```","~~~"][0],trim_code:true,li_bullet:"*-+"[0],hr_char:"-_*"[0],indnt_str:["    ","	","  "][0],bold_char:"*_"[0],emph_char:"*_"[1],gfm_del:true,gfm_tbls:true,tbl_edges:false,hash_lnks:false,br_only:false,col_pre:"col ",nbsp_spc:false,span_tags:true,div_tags:true,unsup_tags:{ignore:"script style noscript",inline:"span sup sub i u b center big",block2:"div form fieldset dl header footer address article aside figure hgroup section",block1c:"dt dd caption legend figcaption output",block2c:"canvas audio video iframe"},tag_remap:{i:"em",b:"strong"}};var isIE=eval("/*@cc_on!@*/!1"),docMode=document.documentMode,ieLt9=isIE&&(!docMode||docMode<9),textContProp="textContent"in Element.prototype||!ieLt9?"textContent":"innerText";extend(cfg,opts);function extend(t,e){if(!e)return t;for(var n in t){if(typeOf(e[n])=="Object")extend(t[n],e[n]);else if(typeof e[n]!=="undefined")t[n]=e[n]}}function typeOf(t){return Object.prototype.toString.call(t).slice(8,-1)}function rep(t,e){var n="";while(e-->0)n+=t;return n}function trim12(t){var t=t.replace(/^\s\s*/,""),e=/\s/,n=t.length;while(e.test(t.charAt(--n)));return t.slice(0,n+1)}function lpad(t,e,n){return rep(e,n-t.length)+t}function rpad(t,e,n){return t+rep(e,n-t.length)}function otag(t,e){if(!t)return"";var n="<"+t;for(var i,r=0;r<e.attributes.length;r++){i=e.attributes.item(r);n+=" "+i.nodeName+'="'+i.nodeValue+'"'}return n+">"}function ctag(t){if(!t)return"";return"</"+t+">"}function pfxLines(t,e){return t.replace(/^/gm,e)}function nodeName(t){return(t.nodeName=="#text"?"txt":t.nodeName).toLowerCase()}function wrap(t,e){var n,i;if(e instanceof Array){n=e[0];i=e[1]}else n=i=e;n=n instanceof Function?n.call(this,t):n;i=i instanceof Function?i.call(this,t):i;return n+t+i}function outerHTML(t){return t.outerHTML||function(t){var e=document.createElement("div"),n;e.appendChild(t.cloneNode(true));n=e.innerHTML;e=null;return n}(t)}this.render=function(t){links=[];var e=document.createElement("div");e.innerHTML=typeof t=="string"?t:outerHTML(t);var n=new lib.tag(e,null,0);var i=n.rend().replace(/^[\t ]+[\n\r]+/gm,"\n").replace(/^[\n\r]+|[\n\r]+$/g,"");if(cfg.link_list&&links.length>0){i+="\n\n";var r=0;for(var l=0;l<links.length;l++){if(!links[l].e.title)continue;var s=links[l].e.href.length;if(s&&s>r)r=s}for(var a=0;a<links.length;a++){var c=links[a].e.title?rep(" ",r+2-links[a].e.href.length)+'"'+links[a].e.title+'"':"";i+="  ["+(+a+1)+"]: "+(nodeName(links[a].e)=="a"?links[a].e.href:links[a].e.src)+c+"\n"}}return i.replace(/^[\t ]+\n/gm,"\n")};var lib={};lib.tag=klass({wrap:"",lnPfx:"",lnInd:0,init:function(t,e,n){this.e=t;this.p=e;this.i=n;this.c=[];this.tag=nodeName(t);this.initK()},initK:function(){var t;if(this.e.hasChildNodes()){var e=cfg.unsup_tags.inline,n,i;if(nodeName(this.e)=="table"){if(this.e.hasChildNodes()&&!this.e.tHead){var r=document.createElement("thead");var l=this.e.tBodies[0],s=l.rows[0],a=s.cells[0];if(nodeName(a)=="th")r.appendChild(s);else{var c,t=0,h=s.cells.length,f=r.insertRow();while(t++<h){c=document.createElement("th");c[textContProp]=cfg.col_pre+t;f.appendChild(c)}}this.e.insertBefore(r,l)}}for(t in this.e.childNodes){if(!/\d+/.test(t))continue;n=this.e.childNodes[t];i=nodeName(n);if(i in cfg.tag_remap)i=cfg.tag_remap[i];if(cfg.unsup_tags.ignore.test(i))continue;if(i=="txt"&&!nodeName(this.e).match(e)&&/^\s+$/.test(n[textContProp])){if(t==0||t==this.e.childNodes.length-1)continue;var o=this.e.childNodes[t-1],u=this.e.childNodes[t+1];if(o&&!nodeName(o).match(e)||u&&!nodeName(u).match(e))continue}var d=null;if(!lib[i]){var p=cfg.unsup_tags;if(p.inline.test(i)){if(i=="span"&&!cfg.span_tags)i="inl";else i="tinl"}else if(p.block2.test(i)){if(i=="div"&&!cfg.div_tags)i="blk";else i="tblk"}else if(p.block1c.test(i))i="ctblk";else if(p.block2c.test(i)){i="ctblk";d=["\n\n",""]}else i="rawhtml"}var b=new lib[i](n,this,this.c.length);if(d)b.wrap=d;if(b instanceof lib.a&&n.href||b instanceof lib.img){b.lnkid=links.length;links.push(b)}this.c.push(b)}}},rend:function(){return this.rendK().replace(/\n{3,}/gm,"\n\n")},rendK:function(){var t,e="";for(var n=0;n<this.c.length;n++){t=this.c[n];e+=(t.bef||"")+t.rend()+(t.aft||"")}return e.replace(/^\n+|\n+$/,"")}});lib.blk=lib.tag.extend({wrap:["\n\n",""],wrapK:null,tagr:false,lnInd:null,init:function(t,e,n){this.supr(t,e,n);if(this.lnInd===null){if(this.p&&this.tagr&&this.c[0]instanceof lib.blk)this.lnInd=4;else this.lnInd=0}if(this.wrapK===null){if(this.tagr&&this.c[0]instanceof lib.blk)this.wrapK="\n";else this.wrapK=""}},rend:function(){return wrap.call(this,(this.tagr?otag(this.tag,this.e):"")+wrap.call(this,pfxLines(pfxLines(this.rendK(),this.lnPfx),rep(" ",this.lnInd)),this.wrapK)+(this.tagr?ctag(this.tag):""),this.wrap)},rendK:function(){var t=this.supr();if(this.p instanceof lib.li){var e=null,n=t.match(/^[\t ]+/gm);if(!n)return t;for(var i=0;i<n.length;i++){if(e===null||n[i][0].length<e.length)e=n[i][0]}return t.replace(new RegExp("^"+e),"")}return t}});lib.tblk=lib.blk.extend({tagr:true});lib.cblk=lib.blk.extend({wrap:["\n",""]});lib.ctblk=lib.cblk.extend({tagr:true});lib.inl=lib.tag.extend({rend:function(){var t=this.rendK(),e=t.match(/^((?: |\t|&nbsp;)*)(.*?)((?: |\t|&nbsp;)*)$/)||[t,"",t,""];return e[1]+wrap.call(this,e[2],this.wrap)+e[3]}});lib.tinl=lib.inl.extend({tagr:true,rend:function(){return otag(this.tag,this.e)+wrap.call(this,this.rendK(),this.wrap)+ctag(this.tag)}});lib.p=lib.blk.extend({rendK:function(){return this.supr().replace(/^\s+/gm,"")}});lib.list=lib.blk.extend({wrap:[function(){return this.p instanceof lib.li?"\n":"\n\n"},""]});lib.ul=lib.list.extend({});lib.ol=lib.list.extend({});lib.li=lib.cblk.extend({wrap:["\n",function(t){return this.c[0]&&this.c[0]instanceof lib.p||t.match(/\n{2}/gm)?"\n":""}],wrapK:[function(){return this.p.tag=="ul"?cfg.li_bullet+" ":this.i+1+".  "},""],rendK:function(){return this.supr().replace(/\n([^\n])/gm,"\n"+cfg.indnt_str+"$1")}});lib.hr=lib.blk.extend({wrap:["\n\n",rep(cfg.hr_char,3)]});lib.h=lib.blk.extend({});lib.h_setext=lib.h.extend({});cfg.h1_setext&&(lib.h1=lib.h_setext.extend({wrapK:["",function(t){return"\n"+rep("=",t.length)}]}));cfg.h2_setext&&(lib.h2=lib.h_setext.extend({wrapK:["",function(t){return"\n"+rep("-",t.length)}]}));lib.h_atx=lib.h.extend({wrapK:[function(t){return rep("#",this.tag[1])+" "},function(t){return cfg.h_atx_suf?" "+rep("#",this.tag[1]):""}]});!cfg.h1_setext&&(lib.h1=lib.h_atx.extend({}));!cfg.h2_setext&&(lib.h2=lib.h_atx.extend({}));lib.h3=lib.h_atx.extend({});lib.h4=lib.h_atx.extend({});lib.h5=lib.h_atx.extend({});lib.h6=lib.h_atx.extend({});lib.a=lib.inl.extend({lnkid:null,rend:function(){var t=this.rendK(),e=this.e.getAttribute("href"),n=this.e.title?' "'+this.e.title+'"':"";if(!this.e.hasAttribute("href")||e==t||e[0]=="#"&&!cfg.hash_lnks)return t;if(cfg.link_list)return"["+t+"] ["+(this.lnkid+1)+"]";return"["+t+"]("+e+n+")"}});lib.img=lib.inl.extend({lnkid:null,rend:function(){var t=this.e.alt,e=this.e.getAttribute("src");if(cfg.link_list)return"!["+t+"] ["+(this.lnkid+1)+"]";var n=this.e.title?' "'+this.e.title+'"':"";return"!["+t+"]("+e+n+")"}});lib.em=lib.inl.extend({wrap:cfg.emph_char});lib.del=cfg.gfm_del?lib.inl.extend({wrap:"~~"}):lib.tinl.extend();lib.br=lib.inl.extend({wrap:["",function(){var t=cfg.br_only?"<br>":"  ";return this.p instanceof lib.h?"<br>":t+"\n"}]});lib.strong=lib.inl.extend({wrap:rep(cfg.bold_char,2)});lib.blockquote=lib.blk.extend({lnPfx:"> ",rend:function(){return this.supr().replace(/>[ \t]$/gm,">")}});lib.pre=lib.blk.extend({tagr:true,wrapK:"\n",lnInd:0});lib.code=lib.blk.extend({tagr:false,wrap:"",wrapK:function(t){return t.indexOf("`")!==-1?"``":"`"},lnInd:0,init:function(t,e,n){this.supr(t,e,n);if(this.p instanceof lib.pre){this.p.tagr=false;if(cfg.gfm_code){var i=this.e.getAttribute("class");i=(i||"").split(" ")[0];if(i.indexOf("lang-")===0)i=i.substr(5);this.wrapK=[cfg.gfm_code+i+"\n","\n"+cfg.gfm_code]}else{this.wrapK="";this.p.lnInd=4}}},rendK:function(){if(this.p instanceof lib.pre){var t=this.e[textContProp];return cfg.trim_code?t.trim():t}return this.supr()}});lib.table=cfg.gfm_tbls?lib.blk.extend({cols:[],init:function(t,e,n){this.supr(t,e,n);this.cols=[]},rend:function(){for(var t=0;t<this.c.length;t++)for(var e=0;e<this.c[t].c.length;e++)for(var n=0;n<this.c[t].c[e].c.length;n++)this.c[t].c[e].c[n].prep();return this.supr()}}):lib.tblk.extend();lib.thead=cfg.gfm_tbls?lib.cblk.extend({wrap:["\n",function(t){var e="";for(var n=0;n<this.p.cols.length;n++){var i=this.p.cols[n],r=i.a[0]=="c"?":":" ",l=i.a[0]=="r"||i.a[0]=="c"?":":" ";e+=(n==0&&cfg.tbl_edges?"|":"")+r+rep("-",i.w)+l+(n<this.p.cols.length-1||cfg.tbl_edges?"|":"")}return"\n"+trim12(e)}]}):lib.ctblk.extend();lib.tbody=cfg.gfm_tbls?lib.cblk.extend():lib.ctblk.extend();lib.tfoot=cfg.gfm_tbls?lib.cblk.extend():lib.ctblk.extend();lib.tr=cfg.gfm_tbls?lib.cblk.extend({wrapK:[cfg.tbl_edges?"| ":"",cfg.tbl_edges?" |":""]}):lib.ctblk.extend();lib.th=cfg.gfm_tbls?lib.inl.extend({guts:null,wrap:[function(){var t=this.p.p.p.cols[this.i],e=this.i==0?"":" ",n,i=t.w-this.guts.length;switch(t.a[0]){case"r":n=rep(" ",i);break;case"c":n=rep(" ",Math.floor(i/2));break;default:n=""}return e+n},function(){var t=this.p.p.p.cols[this.i],e=this.i==this.p.c.length-1?"":" |",n,i=t.w-this.guts.length;switch(t.a[0]){case"r":n="";break;case"c":n=rep(" ",Math.ceil(i/2));break;default:n=rep(" ",i)}return n+e}],prep:function(){this.guts=this.rendK();this.rendK=function(){return this.guts};var t=this.p.p.p.cols;if(!t[this.i])t[this.i]={w:null,a:""};var e=t[this.i];e.w=Math.max(e.w||0,this.guts.length);var n=this.e.align||this.e.style.textAlign;if(n)e.a=n}}):lib.ctblk.extend();lib.td=lib.th.extend();lib.txt=lib.inl.extend({initK:function(){this.c=this.e[textContProp].split(/^/gm)},rendK:function(){var t=this.c.join("").replace(/\r/gm,"");if(!(this.p instanceof lib.code||this.p instanceof lib.pre)){t=t.replace(/^\s*([#*])/gm,function(t,e){return t.replace(e,"\\"+e)})}if(this.i==0)t=t.replace(/^\n+/,"");if(this.i==this.p.c.length-1)t=t.replace(/\n+$/,"");return t.replace(/\u00a0/gm,cfg.nbsp_spc?" ":"&nbsp;")}});lib.rawhtml=lib.blk.extend({initK:function(){this.guts=outerHTML(this.e)},rendK:function(){return this.guts}});for(var i in cfg.unsup_tags)cfg.unsup_tags[i]=new RegExp("^(?:"+(i=="inline"?"a|em|strong|img|code|del|":"")+cfg.unsup_tags[i].replace(/\s/g,"|")+")$")};!function(t,e,n){typeof define=="function"?define(n):typeof module!="undefined"?module.exports=n():e[t]=n()}("klass",this,function(){function t(t){return r.call(e(t)?t:function(){},t,1)}function e(t){return typeof t===s}function n(t,e,n){return function(){var i=this.supr;this.supr=n[c][t];var r={}.fabricatedUndefined,l=r;try{l=e.apply(this,arguments)}finally{this.supr=i}return l}}function i(t,i,r){for(var l in i)i.hasOwnProperty(l)&&(t[l]=e(i[l])&&e(r[c][l])&&a.test(i[l])?n(l,i[l],r):i[l])}function r(t,n){function r(){}function l(){this.init?this.init.apply(this,arguments):(n||h&&s.apply(this,arguments),f.apply(this,arguments))}r[c]=this[c];var s=this,a=new r,h=e(t),f=h?t:this,o=h?{}:t;return l.methods=function(t){return i(a,t,s),l[c]=a,this},l.methods.call(l,o).prototype.constructor=l,l.extend=arguments.callee,l[c].implement=l.statics=function(t,e){return t=typeof t=="string"?function(){var n={};return n[t]=e,n}():t,i(this,t,s),this},l}var l=this,s="function",a=/xyz/.test(function(){xyz})?/\bsupr\b/:/.*/,c="prototype";return t});